var F=Object.defineProperty;var M=(o,e,t)=>e in o?F(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var x=(o,e,t)=>M(o,typeof e!="symbol"?e+"":e,t);import{r as g,a as H,R as W}from"./react-vendor-kKZl61vz.js";import{m as S,H as C,p as $}from"./markdown-vendor-B52Sim4C.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const h of s.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();var I={exports:{}},w={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K=g,U=Symbol.for("react.element"),z=Symbol.for("react.fragment"),B=Object.prototype.hasOwnProperty,q=K.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,G={key:!0,ref:!0,__self:!0,__source:!0};function k(o,e,t){var a,n={},s=null,h=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(h=e.ref);for(a in e)B.call(e,a)&&!G.hasOwnProperty(a)&&(n[a]=e[a]);if(o&&o.defaultProps)for(a in e=o.defaultProps,e)n[a]===void 0&&(n[a]=e[a]);return{$$typeof:U,type:o,key:s,ref:h,props:n,_owner:q.current}}w.Fragment=z;w.jsx=k;w.jsxs=k;I.exports=w;var l=I.exports,R={},A=H;R.createRoot=A.createRoot,R.hydrateRoot=A.hydrateRoot;function J({onOpenFile:o}){return l.jsx("div",{className:"toolbar",children:l.jsx("button",{className:"open-file-btn",onClick:o,"aria-label":"打开文件",children:"打开文件"})})}function Y({tabs:o,activeTabId:e,onTabSelect:t,onTabClose:a,onTabReorder:n}){const[s,h]=g.useState(null),[m,p]=g.useState(null),v=g.useRef(0),y=(i,f)=>{h(f),i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/plain",f);const r=i.currentTarget;setTimeout(()=>{r.classList.add("dragging")},0)},E=i=>{h(null),p(null),v.current=0,i.currentTarget.classList.remove("dragging")},D=(i,f)=>{i.preventDefault(),v.current++,f!==s&&p(f)},N=i=>{i.preventDefault(),v.current--,v.current===0&&p(null)},b=i=>{i.preventDefault(),i.dataTransfer.dropEffect="move"},O=(i,f)=>{if(i.preventDefault(),p(null),v.current=0,!s||s===f)return;const r=[...o],u=r.findIndex(T=>T.id===s),c=r.findIndex(T=>T.id===f);if(u===-1||c===-1)return;const[d]=r.splice(u,1);r.splice(c,0,d),n(r)},j=i=>{t(i)},_=(i,f)=>{i.stopPropagation(),a(f)};return o.length===0?null:l.jsx("div",{className:"tab-bar",children:o.map(i=>l.jsxs("div",{className:`tab ${i.id===e?"active":""} ${i.id===m?"drag-over":""}`,draggable:!0,onClick:()=>j(i.id),onDragStart:f=>y(f,i.id),onDragEnd:E,onDragEnter:f=>D(f,i.id),onDragLeave:N,onDragOver:b,onDrop:f=>O(f,i.id),title:i.filePath,children:[l.jsx("span",{className:"tab-name",children:i.fileName}),l.jsx("button",{className:"tab-close",onClick:f=>_(f,i.id),"aria-label":`关闭 ${i.fileName}`,children:"×"})]},i.id))})}class Z{constructor(e){x(this,"options");x(this,"renderCache",new Map);x(this,"maxCacheSize",50);this.options={breaks:!0,gfm:!0,highlight:this.defaultHighlight,...e},this.configure(this.options)}configure(e){this.options={...this.options,...e},S.setOptions({breaks:this.options.breaks,gfm:this.options.gfm})}defaultHighlight(e,t){if(t&&C.getLanguage(t))try{return C.highlight(e,{language:t}).value}catch(a){console.error("Code highlighting error:",a)}return C.highlightAuto(e).value}render(e){const t=this.getCacheKey(e),a=this.renderCache.get(t);if(a!==void 0)return a;try{const n=S.parse(e),s=$.sanitize(n,{ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","ul","ol","li","a","img","strong","em","code","pre","blockquote","table","thead","tbody","tr","th","td","span","div"],ALLOWED_ATTR:["href","src","alt","title","class","id"],KEEP_CONTENT:!0,RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1,FORCE_BODY:!1,SANITIZE_DOM:!0,IN_PLACE:!1,ALLOW_DATA_ATTR:!1,ALLOW_UNKNOWN_PROTOCOLS:!1,SAFE_FOR_TEMPLATES:!0});return this.addToCache(t,s),s}catch(n){const s=n instanceof Error?n.message:"未知错误";throw new Error(`Markdown 渲染失败: ${s}`)}}getCacheKey(e){let t=0;for(let a=0;a<e.length;a++){const n=e.charCodeAt(a);t=(t<<5)-t+n,t=t&t}return t.toString(36)}addToCache(e,t){if(this.renderCache.size>=this.maxCacheSize){const a=this.renderCache.keys().next().value;a!==void 0&&this.renderCache.delete(a)}this.renderCache.set(e,t)}clearCache(){this.renderCache.clear()}}const Q=new Z;function V({content:o,error:e}){const[t,a]=g.useState(""),[n,s]=g.useState(null);return g.useEffect(()=>{if(o)try{const h=Q.render(o);a(h),s(null)}catch(h){const m=h instanceof Error?h.message:"渲染失败";s(m)}else a(""),s(null)},[o]),e?l.jsx("div",{className:"preview-pane",children:l.jsxs("div",{className:"error-message",children:[l.jsx("h3",{children:"错误"}),l.jsx("p",{children:e})]})}):!o&&!t?l.jsx("div",{className:"preview-pane",children:l.jsx("div",{className:"empty-state",children:l.jsx("p",{children:'点击"打开文件"按钮选择 Markdown文件或将文件拖放到窗口中'})})}):n?l.jsxs("div",{className:"preview-pane",children:[l.jsx("div",{className:"render-error",children:l.jsxs("p",{children:["渲染错误：",n]})}),t&&l.jsx("div",{className:"preview-content",dangerouslySetInnerHTML:{__html:t}})]}):l.jsx("div",{className:"preview-pane",children:l.jsx("div",{className:"preview-content",dangerouslySetInnerHTML:{__html:t}})})}function X({error:o,onClose:e,autoCloseDuration:t=5e3}){if(g.useEffect(()=>{if(o&&t>0){const n=setTimeout(()=>{e()},t);return()=>clearTimeout(n)}},[o,t,e]),!o)return null;const a=n=>({"file-read":"文件读取错误","file-watch":"文件监视错误",render:"渲染错误",unknown:"未知错误"})[n]||"错误";return l.jsx("div",{className:"error-toast",role:"alert","aria-live":"assertive",children:l.jsxs("div",{className:"error-toast-content",children:[l.jsxs("div",{className:"error-toast-header",children:[l.jsx("span",{className:"error-toast-type",children:a(o.type)}),l.jsx("button",{className:"error-toast-close",onClick:e,"aria-label":"关闭错误提示",children:"×"})]}),l.jsx("div",{className:"error-toast-message",children:o.message})]})})}const L=()=>`tab-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,P=o=>{const e=o.split(/[\\/]/);return e[e.length-1]};function ee(){const[o,e]=g.useState([]),[t,a]=g.useState(null),[n,s]=g.useState(null),[h,m]=g.useState(!1),p=o.find(r=>r.id===t),v=(p==null?void 0:p.content)||"",y=g.useCallback(async r=>{const u=o.find(c=>c.filePath===r);if(u){a(u.id);return}try{const c=await window.electronAPI.readFile(r),d={id:L(),filePath:r,fileName:P(r),content:c};e(T=>[...T,d]),a(d.id),s(null)}catch(c){const d=c instanceof Error?c.message:"打开文件失败";s({type:"file-read",message:d})}},[o]),E=async()=>{try{const r=await window.electronAPI.openFile();r&&await y(r)}catch(r){const u=r instanceof Error?r.message:"打开文件失败";s({type:"file-read",message:u})}},D=r=>{a(r)},N=async r=>{const u=o.find(d=>d.id===r);if(!u)return;try{await window.electronAPI.closeFile(u.filePath)}catch(d){console.error("关闭文件监视失败:",d)}const c=o.filter(d=>d.id!==r);e(c),t===r&&(c.length>0?a(c[c.length-1].id):a(null))},b=r=>{e(r)},O=()=>{s(null)},j=r=>{r.preventDefault(),r.stopPropagation(),m(!0)},_=r=>{r.preventDefault(),r.stopPropagation(),r.currentTarget===r.target&&m(!1)},i=r=>{r.preventDefault(),r.stopPropagation()},f=async r=>{r.preventDefault(),r.stopPropagation(),m(!1);const u=Array.from(r.dataTransfer.files);for(const c of u){const d=c.path;d&&(d.endsWith(".md")||d.endsWith(".markdown"))&&await y(d)}u.length>0&&!u.some(c=>{const d=c.path;return d&&(d.endsWith(".md")||d.endsWith(".markdown"))})&&s({type:"file-read",message:"只支持 .md 和 .markdown 文件"})};return g.useEffect(()=>{window.electronAPI.onFileChanged(r=>{e(u=>u.map(c=>c.filePath===r.filePath?{...c,content:r.content}:c)),s(null)}),window.electronAPI.onFileError(r=>{s({type:"file-watch",message:r.message})}),window.electronAPI.onOpenInitialFile(async r=>{e(u=>{const c=u.find(d=>d.filePath===r);return c&&a(c.id),u});try{const u=await window.electronAPI.readFile(r),c={id:L(),filePath:r,fileName:P(r),content:u};e(d=>d.find(T=>T.filePath===r)?d:[...d,c]),a(c.id),s(null)}catch(u){s({type:"file-read",message:u instanceof Error?u.message:"读取文件失败"})}})},[]),l.jsxs("div",{className:`app ${h?"dragging":""}`,onDragEnter:j,onDragLeave:_,onDragOver:i,onDrop:f,children:[l.jsx(J,{onOpenFile:E}),l.jsx(Y,{tabs:o,activeTabId:t,onTabSelect:D,onTabClose:N,onTabReorder:b}),l.jsx(V,{content:v,error:(n==null?void 0:n.message)||null}),l.jsx(X,{error:n,onClose:O,autoCloseDuration:5e3})]})}R.createRoot(document.getElementById("root")).render(l.jsx(W.StrictMode,{children:l.jsx(ee,{})}));
