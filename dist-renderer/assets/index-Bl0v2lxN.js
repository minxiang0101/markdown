var L=Object.defineProperty;var b=(i,e,t)=>e in i?L(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var f=(i,e,t)=>b(i,typeof e!="symbol"?e+"":e,t);import{r as d,a as P,R as S}from"./react-vendor-kKZl61vz.js";import{m as E,H as m,p as D}from"./markdown-vendor-B52Sim4C.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var w={exports:{}},p={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F=d,I=Symbol.for("react.element"),M=Symbol.for("react.fragment"),k=Object.prototype.hasOwnProperty,H=F.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,W={key:!0,ref:!0,__self:!0,__source:!0};function _(i,e,t){var n,r={},s=null,c=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(c=e.ref);for(n in e)k.call(e,n)&&!W.hasOwnProperty(n)&&(r[n]=e[n]);if(i&&i.defaultProps)for(n in e=i.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:I,type:i,key:s,ref:c,props:r,_owner:H.current}}p.Fragment=M;p.jsx=_;p.jsxs=_;w.exports=p;var o=w.exports,g={},x=P;g.createRoot=x.createRoot,g.hydrateRoot=x.hydrateRoot;function K({onOpenFile:i,currentFileName:e}){return o.jsxs("div",{className:"toolbar",children:[o.jsx("button",{className:"open-file-btn",onClick:i,"aria-label":"打开文件",children:"打开文件"}),e&&o.jsx("span",{className:"file-name",title:e,children:e})]})}class U{constructor(e){f(this,"options");f(this,"renderCache",new Map);f(this,"maxCacheSize",50);this.options={breaks:!0,gfm:!0,highlight:this.defaultHighlight,...e},this.configure(this.options)}configure(e){this.options={...this.options,...e},E.setOptions({breaks:this.options.breaks,gfm:this.options.gfm})}defaultHighlight(e,t){if(t&&m.getLanguage(t))try{return m.highlight(e,{language:t}).value}catch(n){console.error("Code highlighting error:",n)}return m.highlightAuto(e).value}render(e){const t=this.getCacheKey(e),n=this.renderCache.get(t);if(n!==void 0)return n;try{const r=E.parse(e),s=D.sanitize(r,{ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","ul","ol","li","a","img","strong","em","code","pre","blockquote","table","thead","tbody","tr","th","td","span","div"],ALLOWED_ATTR:["href","src","alt","title","class","id"],KEEP_CONTENT:!0,RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1,FORCE_BODY:!1,SANITIZE_DOM:!0,IN_PLACE:!1,ALLOW_DATA_ATTR:!1,ALLOW_UNKNOWN_PROTOCOLS:!1,SAFE_FOR_TEMPLATES:!0});return this.addToCache(t,s),s}catch(r){const s=r instanceof Error?r.message:"未知错误";throw new Error(`Markdown 渲染失败: ${s}`)}}getCacheKey(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);t=(t<<5)-t+r,t=t&t}return t.toString(36)}addToCache(e,t){if(this.renderCache.size>=this.maxCacheSize){const n=this.renderCache.keys().next().value;n!==void 0&&this.renderCache.delete(n)}this.renderCache.set(e,t)}clearCache(){this.renderCache.clear()}}const $=new U;function z({content:i,error:e}){const[t,n]=d.useState(""),[r,s]=d.useState(null);return d.useEffect(()=>{if(i)try{const c=$.render(i);n(c),s(null)}catch(c){const h=c instanceof Error?c.message:"渲染失败";s(h)}else n(""),s(null)},[i]),e?o.jsx("div",{className:"preview-pane",children:o.jsxs("div",{className:"error-message",children:[o.jsx("h3",{children:"错误"}),o.jsx("p",{children:e})]})}):!i&&!t?o.jsx("div",{className:"preview-pane",children:o.jsx("div",{className:"empty-state",children:o.jsx("p",{children:'点击"打开文件"按钮选择 Markdown文件或将文件拖放到窗口中'})})}):r?o.jsxs("div",{className:"preview-pane",children:[o.jsx("div",{className:"render-error",children:o.jsxs("p",{children:["渲染错误：",r]})}),t&&o.jsx("div",{className:"preview-content",dangerouslySetInnerHTML:{__html:t}})]}):o.jsx("div",{className:"preview-pane",children:o.jsx("div",{className:"preview-content",dangerouslySetInnerHTML:{__html:t}})})}function q({error:i,onClose:e,autoCloseDuration:t=5e3}){if(d.useEffect(()=>{if(i&&t>0){const r=setTimeout(()=>{e()},t);return()=>clearTimeout(r)}},[i,t,e]),!i)return null;const n=r=>({"file-read":"文件读取错误","file-watch":"文件监视错误",render:"渲染错误",unknown:"未知错误"})[r]||"错误";return o.jsx("div",{className:"error-toast",role:"alert","aria-live":"assertive",children:o.jsxs("div",{className:"error-toast-content",children:[o.jsxs("div",{className:"error-toast-header",children:[o.jsx("span",{className:"error-toast-type",children:n(i.type)}),o.jsx("button",{className:"error-toast-close",onClick:e,"aria-label":"关闭错误提示",children:"×"})]}),o.jsx("div",{className:"error-toast-message",children:i.message})]})})}function B(){const[i,e]=d.useState(null),[t,n]=d.useState(""),[r,s]=d.useState(null),[c,h]=d.useState(!1),N=async()=>{try{const a=await window.electronAPI.openFile();a&&(e(a),await y(a))}catch(a){const l=a instanceof Error?a.message:"打开文件失败";s({type:"file-read",message:l})}},y=async a=>{try{const l=await window.electronAPI.readFile(a);n(l),s(null)}catch(l){const v=l instanceof Error?l.message:"读取文件失败";s({type:"file-read",message:v})}},O=()=>{s(null)},j=a=>{if(!a)return null;const l=a.split(/[\\/]/);return l[l.length-1]},C=a=>{a.preventDefault(),a.stopPropagation(),h(!0)},R=a=>{a.preventDefault(),a.stopPropagation(),a.currentTarget===a.target&&h(!1)},T=a=>{a.preventDefault(),a.stopPropagation()},A=async a=>{a.preventDefault(),a.stopPropagation(),h(!1);const l=Array.from(a.dataTransfer.files);if(l.length>0){const u=l[0].path;u&&(u.endsWith(".md")||u.endsWith(".markdown"))?(e(u),await y(u)):s({type:"file-read",message:"只支持 .md 和 .markdown 文件"})}};return d.useEffect(()=>{window.electronAPI.onFileChanged(a=>{n(a),s(null)}),window.electronAPI.onFileError(a=>{s({type:"file-watch",message:a})}),window.electronAPI.onOpenInitialFile(async a=>{e(a);try{const l=await window.electronAPI.readFile(a);n(l),s(null)}catch(l){s({type:"file-read",message:l instanceof Error?l.message:"读取文件失败"})}})},[]),o.jsxs("div",{className:`app ${c?"dragging":""}`,onDragEnter:C,onDragLeave:R,onDragOver:T,onDrop:A,children:[o.jsx(K,{onOpenFile:N,currentFileName:j(i)}),o.jsx(z,{content:t,error:(r==null?void 0:r.message)||null}),o.jsx(q,{error:r,onClose:O,autoCloseDuration:5e3})]})}g.createRoot(document.getElementById("root")).render(o.jsx(S.StrictMode,{children:o.jsx(B,{})}));
